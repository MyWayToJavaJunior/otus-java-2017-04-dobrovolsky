<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Admin</title>
    <script>
        init = function WS(){
            function CacheStatistics() {

                document.getElementById('status').innerHTML = 'Status OK';

                this.ws = null;
                this.interval = null;
                this.init = function () {
                    this.ws = new WebSocket("ws://localhost:${port}/admin_by_ws");
                    this.ws.onopen = function (event) {
                        console.log('WebSocket onOpen');
                    };

                    this.ws.onmessage = function (event) {
                        console.log('WebSocket onMessage');

                        var data = JSON.parse(event.data);

                        document.getElementById('queries').innerHTML = data.queries;
                        document.getElementById('queryCacheHitCount').innerHTML = data.queryCacheHitCount;
                        document.getElementById('queryCacheMissCount').innerHTML = data.queryCacheMissCount;
                        document.getElementById('queryCachePutCount').innerHTML = data.queryCachePutCount;
                        document.getElementById('secondLevelCacheHitCount').innerHTML = data.secondLevelCacheHitCount;
                        document.getElementById('secondLevelCacheMissCount').innerHTML = data.secondLevelCacheMissCount;
                        document.getElementById('secondLevelCachePutCount').innerHTML = data.secondLevelCachePutCount;
                        document.getElementById('secondLevelCacheRegionNames').innerHTML = data.secondLevelCacheRegionNames;
                        document.getElementById('sessionOpenCount').innerHTML = data.sessionOpenCount;
                        document.getElementById('sessionCloseCount').innerHTML = data.sessionCloseCount;

                    };

                    // Log errors
                    this.onerror = function (error) {
                    console.log('WebSocket Error ' + error);
                    };

                    this.ws.onclose = function (event) {
                        document.getElementById('status').innerHTML = 'Status websocket CLOSED';

                        console.log('WebSoceket onClose');
                    };
                };
            }
            var cache = new CacheStatistics();
            cache.init();
        };


    </script>
</head>
<body onload="init();">
<table border="3">
    <tr>
        <td><a href="index.html">Index</a></td>
        <td>
            <form action="/exit" method="POST">
                <button type="submit" name="exit" value="logout" class="btn-link">Exit</button>
            </form>
        </td>
        <td id="status">Status...</td>
    </tr>
</table>

<p>Welcome admin!</p>

<p>Please be patient cause some of information will update after some time, something around 1 min (QueryCache Hit Count
    for example)</p>
<p>Here some information:</p>

<p>Для вычисления кеша были размечены следующие сущности: UserDataSet, PhoneDataSet, AddressDataSet. Включен
    QueryCache.</p>
<p>Для корректного отображения состояния кеша были применены Cache Regions.</p>
<p>В работе приложния используются NamedQuery с принудительным кешированием и явным указанием Cache Region'а.</p>
<p>Для доступа к объектам используются запросы, сформированные из строки, содержащей SQL query - с принудительным
    кешированием и указанием Cache Region'а.</p>
<br/>
<table border="1">
    <tr>
        <td>Queries:</td>
        <td id="queries"></td>
    </tr>
    <tr>
        <td>QueryCache Hit Count:</td>
        <td id="queryCacheHitCount"></td>
    </tr>
    <tr>
        <td>QueryCache Miss Count:</td>
        <td id="queryCacheMissCount"></td>
    </tr>
    <tr>
        <td>QueryCache Put Count:</td>
        <td id="queryCachePutCount"></td>
    </tr>
    <tr>
        <td>Second Level Cache Hit Count (Total value):</td>
        <td id="secondLevelCacheHitCount"></td>
    </tr>
    <tr>
        <td>Second Level Cache Miss Count (Total value):</td>
        <td id="secondLevelCacheMissCount"></td>
    </tr>
    <tr>
        <td>Second Level Cache Put Count:</td>
        <td id="secondLevelCachePutCount"></td>
    </tr>
    <tr>
        <td>Second Level Cache Region Names:</td>
        <td id="secondLevelCacheRegionNames"></td>
    </tr>
    <tr>
        <td>Session Open Count:</td>
        <td id="sessionOpenCount"></td>
    </tr>
    <tr>
        <td>Session Close Count:</td>
        <td id="sessionCloseCount"></td>
    </tr>
</table>
</body>
</html>